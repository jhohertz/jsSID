<!DOCTYPE html>
<html>
  <head>
    <title>JSSID demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="css/bootstrap-responsive.min.css" rel="stylesheet" media="screen">
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../assets/js/html5shiv.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="#">jsSID</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="#">Home</a></li>
              <!--
              <li><a href="#about">About</a></li>
              <li><a href="#contact">Contact</a></li>
              -->
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="span9">
          <div id="alertarea">
            <div class="alert">
              <button type="button" class="close" data-dismiss="alert">&times;</button>
              Select a SID file or register dump to play back.
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="span2">
          <!-- transport controls -->
          <div class="btn-toolbar pull-left">
            <div class="btn-group">
              <a class="btn disabled" href="#" id="play"><i class="icon-play"></i></a>
              <a class="btn disabled" href="#" id="stop"><i class="icon-stop"></i></a>
              <a class="btn disabled" href="#" id="prev"><i class="icon-step-backward"></i></a>
              <a class="btn disabled" href="#" id="next"><i class="icon-step-forward"></i></a>
            </div>
          </div>
        </div>
        <div class="span7">
          <br/>
          <div id="trackinfo">
            <p>No file loaded</p>
          </div>
        </div>
      </div>

      <div class="row">
        <!-- current file selector -->
        <div class="span6">
          <div class="tabbable"> <!-- Only required for left/right tabs -->
            <ul class="nav nav-tabs">
              <li class="active"><a href="#tab-sids" data-toggle="tab">SID Files</a></li>
              <li><a href="#tab-dumps" data-toggle="tab">Register Dumps</a></li>
              <li><a href="#tab-quality" data-toggle="tab">Quality</a></li>
              <li><a href="#tab-model" data-toggle="tab">Model</a></li>
              <li><a href="#tab-about" data-toggle="tab">About</a></li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane active" id="tab-sids">
                <ul class="unstyled">
                  <li><i class="icon-music"></i> <a href="javascript:void(playsid('sid/real/Last_Wader.sid'))">Last_Wader.sid</a></li>
                  <li><i class="icon-music"></i> <a href="javascript:void(playsid('sid/real/Sweet_JB.sid'))">Sweet_JB.sid</a></li>
                  <li><i class="icon-music"></i> <a href="javascript:void(playsid('sid/real/Robocop_3.sid'))">Robocop_3.sid</a></li>
                  <li><i class="icon-music"></i> <a href="javascript:void(playsid('sid/real/Voe_Taevas.sid'))">Voe_Taevas.sid</a></li>
                  <li><i class="icon-music"></i> <a href="javascript:void(playsid('sid/real/Monty_on_the_Run.sid'))">Monty_on_the_Run.sid</a></li>
                  <li><i class="icon-music"></i> <a href="javascript:void(playsid('sid/real/Anal_ogue.sid'))">Anal_ogue.sid</a></li>
                  <li><i class="icon-music"></i> <a href="javascript:void(playsid('sid/real/Azmagutah_6581.sid'))">Azmagutah_6581.sid</a></li>
                  <li><i class="icon-music"></i> <a href="javascript:void(playsid('sid/real/Electronic_Transfer.sid'))">Electronic_Transfer.sid</a></li>
                  <li><i class="icon-music"></i> <a href="javascript:void(playsid('sid/real/National_Park_GRAVE_DANGER.sid'))">National_Park_GRAVE_DANGER.sid</a></li>
                  <li><i class="icon-music"></i> <a href="javascript:void(playsid('sid/real/Viidakko.sid'))">Viidakko.sid</a></li>
                  <li><i class="icon-music"></i> <a href="javascript:void(playsid('sid/real/Driller.sid'))">Driller.sid</a></li>
                  <li><i class="icon-music"></i> <a href="javascript:void(playsid('sid/real/Arabian_Lemmings.sid'))">Arabian_Lemmings.sid</a></li>
                  <li><i class="icon-music"></i> <a href="javascript:void(playsid('sid/real/Sanxion.sid'))">Sanxion.sid</a></li>
                </ul>
                <p>If you are the rights holder of a sid that you would like to see removed (or added!) please <a href="https://github.com/jhohertz">contact me</a> with the details.</p>
              </div>
              <div class="tab-pane" id="tab-dumps">
                <ul class="unstyled">
                  <li><i class="icon-music"></i> <a href="javascript:void(playdmp('sid/dmp/Autumn.dmp'))">Autumn.dmp</a></li>
                  <li><i class="icon-music"></i> <a href="javascript:void(playdmp('sid/dmp/Monty.dmp'))">Monty.dmp</a></li>
                  <li><i class="icon-music"></i> <a href="javascript:void(playdmp('sid/dmp/Robocop3.dmp'))">Robocop3.dmp</a></li>
                  <li><i class="icon-music"></i> <a href="javascript:void(playdmp('sid/dmp/Mr_Marvellous.dmp'))">Mr_Marvellous.dmp</a></li>
                </ul>
              </div>
              <div class="tab-pane" id="tab-quality">
                <p>Quality setting changes take effect on the next track loaded.</p>

                <label class="radio">
                  <input type="radio" name="quality" id="optionsQualityLow" value="low">
                  Low - TinySID
                </label>

                <label class="radio">
                  <input type="radio" name="quality" id="optionsQualityMedium" value="medium">
                  Medium - FastSID
                </label>

                <label class="radio">
                  <input type="radio" name="quality" id="optionsQualityGood" value="good" checked>
                  Good - ReSID Fast
                </label>

                <label class="radio">
                  <input type="radio" name="quality" id="optionsQualityBetter" value="better">
                  Better - ReSID Interpolate
                </label>

                <label class="radio">
                  <input type="radio" name="quality" id="optionsQualityBest" value="best">
                  Best - ReSID Resample/Interpolate
                </label>

              </div>
              <div class="tab-pane" id="tab-model">
                <p>
                  Model setting changes take effect on the next track loaded.
                </p>

                <h4>Model:</h4>
                <label class="radio">
                  <input type="radio" name="sidmodel" id="optionsModel6581" value="6581" checked>
                  6581
                </label>

                <label class="radio">
                  <input type="radio" name="sidmodel" id="optionsModel8580" value="8580">
                  8580
                </label>

                <h4>Frequency:</h4>
                <label class="radio">
                  <input type="radio" name="sidfreq" id="optionsFreqPAL" value="PAL" checked>
                  PAL
                </label>

                <label class="radio">
                  <input type="radio" name="sidfreq" id="optionsFreqNTSC" value="NTSC">
                  NTSC
                </label>
              </div>
              <div class="tab-pane" id="tab-about">
                <p>Works in Firefox/Chrome on desktop + ios6+ and android</p>
                <p>No IE support until IE 12, which implements the audio APIs I hear?</p>
                <p>Code available <a href="https://github.com/jhohertz/jsSID">at the GitHub repository</a></p>
              </div>
            </div>
          </div>
        </div>

      </div>

    </div>

    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="js/bootstrap.min.js"></script>


    <script src="js/jsxcompressor.js"></script>
    <script src="js/stream.js"></script>
    <script src="js/jssid.core.js"></script>
    <script src="js/jssid.tinysid.js"></script>
    <script src="js/jssid.fastsid.js"></script>
    <script src="js/jssid.resid.js"></script>
    <script src="js/jssid.mos6510.js"></script>
    <script src="js/jssid.sidplayer.js"></script>
    <script src="js/jssid.dmpplayer.js"></script>
    <script src="js/pico.dev.js"></script>
    <script>

      function getQuality() {
        var selectedVal = "";
        var selected = $("input[type='radio'][name='quality']:checked");
        if (selected.length > 0) {
          selectedVal = selected.val();
        }
        if(selectedVal == "") {
          selectedVal = "medium";
        }
        return jsSID.quality[selectedVal];
      }

      function getModel() {
        var selectedVal = "";
        var selected = $("input[type='radio'][name='sidmodel']:checked");
        if (selected.length > 0) {
          selectedVal = selected.val();
        }
        if(selectedVal == "") {
          selectedVal = "6581";
        }
        return jsSID.chip.model["MOS" + selectedVal];
      }

      function getFreq() {
        var selectedVal = "";
        var selected = $("input[type='radio'][name='sidfreq']:checked");
        if (selected.length > 0) {
          selectedVal = selected.val();
        }
        if(selectedVal == "") {
          selectedVal = "PAL";
        }
        return jsSID.chip.clock[selectedVal];
      }

      function showalert(message) {
        $("#alertarea").html("<div class=\"alert\">" +
            "<button type=\"button\" class=\"close\" data-dismiss=\"alert\">&times;</button>" +
            message +
            "</div>\n"
        );
      }

      var sidPlayer;
      var sidDmpPlayer;
      var isPlaying = false;
      // used by load for autoplay after load
      var wasPlaying = false;

      function killPlayers() {
        isPlaying = false;
        $("#play").unbind("click").addClass("disabled");
        $("#stop").unbind("click").addClass("disabled");
        $("#next").unbind("click").addClass("disabled");
        $("#prev").unbind("click").addClass("disabled");

        if(sidPlayer != null) {
          sidPlayer.stop();
	  sidPlayer = null;
        }
        if(sidDmpPlayer != null) {
          sidDmpPlayer.stop();
	  sidDmpPlayer = null;
        }
      }

      function manageButtonDisableDmp() {
	if (isPlaying) {
	  $("#stop").removeClass("disabled");
	  $("#play").addClass("disabled");
        } else { 
	  $("#stop").addClass("disabled");
	  $("#play").removeClass("disabled");
        }
      }

      function manageButtonDisable() {
      	manageButtonDisableDmp();
        if (sidPlayer.getSidFile().getSubSongs() == 0) {
	  $("#next").addClass("disabled");
	  $("#prev").addClass("disabled");
        } else {
          if (sidPlayer.getSidFile().getCurrentSong() == sidPlayer.getSidFile().getSubSongs()) {
	    $("#next").addClass("disabled");
	  } else {
	    $("#next").removeClass("disabled");
	  }
          if (sidPlayer.getSidFile().getCurrentSong() == 0) {
	    $("#prev").addClass("disabled");
	  } else {
	    $("#prev").removeClass("disabled");
	  }
        }
      }

      function playsid(file) {
        // this be ugly, but ok till generic players
        wasPlaying = isPlaying;
        this.killPlayers();
        sidPlayer = new jsSID.SIDPlayer({ quality: getQuality(), clock: getFreq(), model: getModel() });
        $("#status").text("Loading: " + file);
        Stream.loadRemoteFile(file, function(data) {
          sidPlayer.loadFileFromData(data)
          $("#play").unbind("click").click(function(){
            isPlaying = true;
	    sidPlayer.play()
            manageButtonDisable();
          });
          $("#stop").unbind("click").click(function(){
            isPlaying = false;
	    sidPlayer.stop();
            manageButtonDisable();
          });
          $("#next").unbind("click").click(function(){
	    sidPlayer.nextTrack();
            $("#trackinfo").html(sidPlayer.getSidFile().infostring());
            if (isPlaying == true) {
	      sidPlayer.play();
	    }
            manageButtonDisable();
          });
          $("#prev").unbind("click").click(function(){
	    sidPlayer.prevTrack();
            $("#trackinfo").html(sidPlayer.getSidFile().infostring());
            if (isPlaying == true) {
	      sidPlayer.play();
	    }
            manageButtonDisable();
          });
          $("#trackinfo").html(sidPlayer.getSidFile().infostring());
	  // this state is kind if kludged, should be a neverPlayed = true flag that players clear for this
          if (wasPlaying == true) {
	    sidPlayer.play();
            isPlaying = true;
            showalert("Loaded: " + file);
	  } else {
            isPlaying = false;
            showalert("Loaded: " + file + ", press play");
          }
          manageButtonDisable();
        });
      }

      function playdmp(file) {
        wasPlaying = isPlaying;
        this.killPlayers();
        sidDmpPlayer = new jsSID.DMPPlayer( { quality: getQuality(), clock: getFreq(), model: getModel() });
        $("#status").text("Loading: " + file);
        Stream.loadRemoteFile(file, function(data) {
          sidDmpPlayer.loadFileFromData(data)
          $("#play").unbind("click").click(function(){
            isPlaying = true;
	    sidDmpPlayer.play();
            manageButtonDisableDmp();
          });
          $("#stop").unbind("click").click(function(){
            isPlaying = false;
            sidDmpPlayer.stop()
            manageButtonDisableDmp();
          });
          $("#trackinfo").html(file);
          if (wasPlaying == true) {
	    sidDmpPlayer.play();
            isPlaying = true;
            showalert("Loaded: " + file);
	  } else {
            isPlaying = false;
            showalert("Loaded: " + file + ", press play");
          }
          manageButtonDisableDmp();
        });
      }

      function addStatus(msg) {
        jQuery("#err").append("<br/>" + msg);
      };

      window.onerror = function(errorMsg, url, lineNumber) {
        addStatus("JAVASCRIPT ERROR: " + errorMsg + " (" + url + ", line " + lineNumber + ")");
      }

    </script>

  </body>
</html>
